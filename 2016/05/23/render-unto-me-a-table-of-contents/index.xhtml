<?xml version="1.0" encoding="utf-8"?> <?xml-stylesheet href="../../../../stylesheets/visual-448a0785.css" media="print,screen"?> <?xml-stylesheet href="../../../../stylesheets/print-42792b28.css" media="print"?> <?xml-stylesheet href="../../../../stylesheets/screen-283d9948.css" media="screen"?> <!DOCTYPE html> <html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb-oxendict"> <head> <meta name="viewport" content="width=device-width, initial-scale=1"/> <title>Render unto me, a table of contents—Fear Goidte</title> <link rel="canonical" href="https://isfeargoidte.me.uk/2016/05/23/render-unto-me-a-table-of-contents"/> <link property="rdfa:copy" href="#ccpattern"/> <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/atom.xml"/> <link rel="apple-touch-icon" sizes="57x57" href="../../../../images/icons/favicons/apple-touch-icon-57x57-2a3cc969.png"/> <link rel="apple-touch-icon" sizes="60x60" href="../../../../images/icons/favicons/apple-touch-icon-60x60-1af4e7c4.png"/> <link rel="apple-touch-icon" sizes="72x72" href="../../../../images/icons/favicons/apple-touch-icon-72x72-83fb944a.png"/> <link rel="apple-touch-icon" sizes="76x76" href="../../../../images/icons/favicons/apple-touch-icon-76x76-ba38ff8e.png"/> <link rel="apple-touch-icon" sizes="114x114" href="../../../../images/icons/favicons/apple-touch-icon-114x114-8c7461bb.png"/> <link rel="apple-touch-icon" sizes="120x120" href="../../../../images/icons/favicons/apple-touch-icon-120x120-61eda8dc.png"/> <link rel="apple-touch-icon" sizes="144x144" href="../../../../images/icons/favicons/apple-touch-icon-144x144-dbae851f.png"/> <link rel="apple-touch-icon" sizes="152x152" href="../../../../images/icons/favicons/apple-touch-icon-152x152-7cff5c09.png"/> <link rel="apple-touch-icon" sizes="180x180" href="../../../../images/icons/favicons/apple-touch-icon-180x180-a952c0b9.png"/> <link rel="icon" type="image/png" href="../../../../images/icons/favicons/favicon-32x32-db637568.png" sizes="32x32"/> <link rel="icon" type="image/png" href="../../../../images/icons/favicons/favicon-194x194-a63210d5.png" sizes="194x194"/> <link rel="icon" type="image/png" href="../../../../images/icons/favicons/favicon-96x96-5b0b9c2b.png" sizes="96x96"/> <link rel="icon" type="image/png" href="../../../../images/icons/favicons/android-chrome-192x192-e83a636a.png" sizes="192x192"/> <link rel="icon" type="image/png" href="../../../../images/icons/favicons/favicon-16x16-ed280661.png" sizes="16x16"/> <link rel="manifest" href="/images/icons/favicons/manifest.json"/> <link rel="mask-icon" href="../../../../images/icons/favicons/safari-pinned-tab-2bcc2848.svg"/> <link rel="shortcut icon" href="../../../../images/icons/favicons/favicon-f27fff1c.ico"/> <meta name="msapplication-TileColor" content="#da532c"/> <meta name="msapplication-TileImage" content="../../../../images/icons/favicons/mstile-144x144-b8ec8551.png"/> <meta name="msapplication-config" content="/images/icons/favicons/browserconfig.xml"/> <meta name="theme-color" content="#ffffff"/> <meta name="author" content="James Ó Nuanáin"/> <meta name="description" content="To have an automatically generated table of contents whilst using the Middleman static site generator with Embedded Ruby for templates/layouts and markdown for simple formatting, I have made some modifications to a vanilla install of Middleman. "/> </head> <body> <a href="#nav_main">Skip to main content</a> <div role="banner"> <dl> <dt xml:lang="ga-ie"><a href="../../../../">Fear Goidte</a></dt> <dd>Pronounced like “Far Gotcha”. The splendid online isolation of me, James Ó Nuanáin, wherein I gather together any loose cleverness that I manage to accumulate. This site is, primarily an exegesis on how it was made. For the moment, it is mostly beak and bone with very little feather and fur. </dd> </dl> <div role="navigation"> <ol> <li><a href="../../../../" accesskey="1">Home</a></li> <li><a href="../../../../archives">Archives</a></li> <li><a href="#nav_copyright" accesskey="6">Copyright</a></li> <li><a href="#nav_accesskeys" accesskey="k">Access keys</a></li> <li><a href="/atom.xml" rel="alternate" accesskey="f">Web feed</a></li> <li><a href="../../../../colophon">Colophon</a></li> </ol> </div> </div> <main id="nav_main" typeof="DCMIType:text schema:Article" resource="https://isfeargoidte.me.uk/2016/05/23/render-unto-me-a-table-of-contents"> <header> <p class="published-date icon"><time property="dcterms:created schema:dateCreated schema:datePublished" datetime="2016-05-23">Monday 23<sup>rd</sup>&#160;May,&#160;2016</time></p> <h1 property="dcterms:title schema:Headline">Render unto me, a table of contents</h1> <p class="subtitle">Generating a table of contents in Middleman using embedded Ruby</p> <p class="author icon">James Ó Nuanáin</p> <p class="reading-time icon">Estimated reading time: two minutes</p> <dl> <dt>Tagged with</dt> <dd><a href="/tags/eruby" rel="tag">eRuby</a></dd> <dd><a href="/tags/markdown" rel="tag">Markdown</a></dd> <dd><a href="/tags/middleman" rel="tag">Middleman</a></dd> <dd><a href="/tags/redcarpet" rel="tag">Redcarpet</a></dd> <dd><a href="/tags/xhtml" rel="tag"><abbr title="eXtensible Hypertext Mark-up Language" class="initialism">X.H.T.M.L.</abbr></a></dd> </dl> <link property="rdfa:copy" href="#ccpattern"/> </header> <nav><h2>Table of contents</h2><ol property="dcterms:tableofContents"> <li> <a href="#background">Background</a> </li> <li> <a href="#code">Code</a> <ol> <li> <a href="#change-markdown-renderer-to-red-carpet">Change markdown renderer to red carpet</a> </li> <li> <a href="#generate-the-id-attributes-for-the-headings">Generate the <code>id</code> attributes for the headings</a> </li> <li> <a href="#generate-the-table-of-contents">Generate the table of contents</a> </li> </ol> </li> <li> <a href="#end-note">End note</a> </li> </ol> </nav> <p property="dcterms:description schema:description">To have an automatically generated table of contents whilst using the <a href="https://middlemanapp.com">Middleman</a> static site generator with Embedded Ruby for templates/layouts and markdown for simple formatting, I have made some modifications to a vanilla install of Middleman. </p> <h2 id="background">Background</h2> <p>Please bear in mind, that I am no programmer and have merely hacked together this ugly edifice. However, since I couldn’t <a href="https://duckduckgo.com">DuckDuckGo</a> a way of doing this I thought I would share my solution in case it is of use to someone else.</p> <h2 id="code">Code</h2> <h3 id="change-markdown-renderer-to-red-carpet">Change markdown renderer to red carpet</h3> <p>Firstly, I am using <a href="https://github.com/vmg/redcarpet">Redcarpet</a> as my markdown renderer. Installation instructions are on their site. Once it is installed, to add Redcarpet to Middleman, insert the following into Middleman’s <code>Gemfile</code>:</p> <pre class="code-quote ruby"><code><span class="n">gem</span> <span class="s2">"redcarpet"</span>
</code></pre> <h3 id="generate-the-id-attributes-for-the-headings">Generate the <code>id</code> attributes for the headings</h3> <p>In the <code>config.erb</code> file, I made the following changes.</p> <p>Switched the renderer from the default <a href="http://kramdown.gettalong.org">Kramdown</a> to Redcarpet:</p> <pre class="code-quote ruby"><code><span class="n">set</span> <span class="ss">:markdown_engine</span><span class="p">,</span> <span class="ss">:redcarpet</span>
<span class="n">set</span> <span class="ss">:markdown</span><span class="p">,</span> <span class="ss">with_toc_data: </span><span class="kp">true</span><span class="p">,</span>
               <span class="ss">xhtml: </span><span class="kp">true</span>
</code></pre> <p>Create a helper file:</p> <pre class="code-quote ruby"><code><span class="k">def</span> <span class="nf">table_of_contents</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">config</span><span class="p">.</span><span class="nf">markdown_engine</span> <span class="o">==</span> <span class="ss">:redcarpet</span> <span class="o">&amp;&amp;</span> <span class="n">config</span><span class="p">.</span><span class="nf">markdown</span><span class="p">[</span><span class="ss">:with_toc_data</span><span class="p">]</span>
    <span class="n">renderer</span> <span class="o">=</span> <span class="no">Redcarpet</span><span class="o">::</span><span class="no">Markdown</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">Redcarpet</span><span class="o">::</span><span class="no">Render</span><span class="o">::</span><span class="no">HTML_TOC</span><span class="p">,</span>
                                       <span class="ss">fenced_code_blocks: </span><span class="kp">true</span><span class="p">,</span>
                                       <span class="ss">xhtml: </span><span class="kp">true</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="o">::</span><span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">page</span><span class="p">.</span><span class="nf">source_file</span><span class="p">)</span>
    <span class="n">tocpre</span> <span class="o">=</span> <span class="s1">'&lt;nav&gt;&lt;h2&gt;Table of contents&lt;/h2&gt;'</span>
    <span class="n">tocpost</span> <span class="o">=</span> <span class="s1">'&lt;/nav&gt;'</span>
    <span class="c1"># ignore YAML frontmatter</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">file</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="sr">/^(---\s*\n.*?\n?)^(---\s*$\n?)/m</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">file</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="s1">' &amp; '</span><span class="p">,</span> <span class="s1">' &amp;amp; '</span><span class="p">)</span>
    <span class="c1"># Switch to ordered lists</span>
    <span class="n">toc</span> <span class="o">=</span> <span class="n">renderer</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">toc</span> <span class="o">=</span> <span class="n">toc</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="s1">'&lt;ul&gt;'</span><span class="p">,</span> <span class="s1">'&lt;ol property="dcterms:tableofContents"&gt;'</span><span class="p">)</span>
    <span class="n">toc</span> <span class="o">=</span> <span class="n">toc</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="s1">'&lt;ul&gt;'</span><span class="p">,</span> <span class="s1">'&lt;ol&gt;'</span><span class="p">)</span>
    <span class="n">toc</span> <span class="o">=</span> <span class="n">toc</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="s1">'&lt;/ul&gt;'</span><span class="p">,</span> <span class="s1">'&lt;/ol&gt;'</span><span class="p">)</span>
    <span class="n">tocpre</span> <span class="o">+</span> <span class="n">toc</span> <span class="o">+</span> <span class="n">tocpost</span> <span class="k">unless</span> <span class="n">toc</span><span class="p">.</span><span class="nf">empty?</span>
  <span class="k">end</span> <span class="c1"># End check for Redcarpet and toc_data</span>
<span class="k">end</span>

</code></pre> <p>Save the above code in a new file named and saved in the <code>my_test_website\helpers\table_of_contents.rb</code> where “<code>my_test_website</code>” is the name of your project’s directory.</p> <h3 id="generate-the-table-of-contents">Generate the table of contents</h3> <p>The table of contents can then be added to a file that is processing embedded Ruby by adding the following code:</p> <pre class="code-quote ruby"><code>    <span class="o">&lt;</span><span class="sx">%= table_of_contents(current_page) %&gt;
</span></code></pre> <p>I tend to add this to my templates but it could also be added to an ‘article’ or ‘page’ file as long as the first of its extensions is <code>.erb</code>.</p> <h2 id="end-note">End note</h2> <p>I am sure that the code above could be simplified. <a href="https://github.com/vmg/redcarpet/issues/529"><em>Redcarpet</em> has an issue rendering ampersands and other characters with its renderer</a> so this code will need to be amended once that is fixed (<code>file = file.gsub(&#39; &amp; &#39;, &#39; &amp;amp; &#39;)</code>).</p> <footer> <p>This document was last modified on <time property="dcterms:modified schema:dateModified" datetime="2016-05-23T15:05:52+01:00">Monday 23<sup>rd</sup>&#160;May,&#160;2016 at 15:05 (London)</time>.</p> <p id="nav_copyright" resource="#ccpattern" typeof="rdfa:Pattern">Copyright © <time property="schema:copyrightYear">1994</time>–<time>2016</time> <span property="cc:attributionName dcterms:creator schema:creator schema:publisher" resource="#me"><a href="https://isfeargoidte.me.uk" property="cc:attributionURL" rel="author">James Ó Nuanáin</a></span>. Except where otherwise indicated, this document (and all of its contents) is licensed under a <a accesskey="5" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" property="cc:license dcterms:license schema:license" rel="license">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International Licence</a>.</p> <address resource="#me" typeof="foaf:Person schema:Person"> <span property="foaf:name schema:Name">James Ó Nuanáin</span> has this website (<a property="foaf:weblog schema:url" href="https://isfeargoidte.me.uk/"><span xml:lang="ga-ie">Fear Goidte</span></a>). His inane witterings are also available on <span property="foaf:holdsAccount" typeof="foaf:OnlineAccount"> <a href="https://twitter.com/" property="foaf:accountServiceHomepage">Twitter</a> where his user name is ‘<span property="foaf:accountName"><a href="https://twitter.com/feargoidte">@feargoidte</a></span>’. </span> His feeble attempts at coding are available on <span property="foaf:holdsAccount" typeof="foaf:OnlineAccount"> <a property="foaf:accountServiceHomepage" href="https://github.com/">Github</a> where his user name is similarly ‘<span property="foaf:accountName"><a href="https://github.com/FearGoidte">FearGoidte</a></span>’. </span> </address> <table id="nav_accesskeys"> <caption>This page makes use of the following <code>accesskey</code> shortcuts:</caption> <thead> <tr> <th>Location</th> <th>Access Key</th> </tr> </thead> <tbody> <tr> <th>Home</th> <td><kbd>1</kbd></td> </tr> <tr> <th>Licence</th> <td><kbd>5</kbd></td> </tr> <tr> <th>Copyright</th> <td><kbd>6</kbd></td> </tr> <tr> <th>Access Keys</th> <td><kbd>k</kbd></td> </tr> <tr> <th>Previous article</th> <td><kbd>p</kbd></td> </tr> <tr> <th>Next article</th> <td><kbd>n</kbd></td> </tr> </tbody> </table> <p id="nav_validation">This page is authored in, <em>hopefully</em>, <a accesskey="v" href="https://validator.nu/?doc=https%3A%2F%2Fisfeargoidte.me.uk%2F2016%2F05%2F23%2Frender-unto-me-a-table-of-contents&amp;showsource=yes&amp;showoutline=yes" rel="nofollow">well-formed <abbr title="eXtensible Hypertext Mark-up Langauge" class="initialism">X.H.T.M.L.</abbr></a> (the validator link is so that I can occasionally check on the mark-up).</p> </footer> </main> <ol class="post-navigation" role="navigation"> <li class="icon prev">Previous: <a href="/2016/04/02/enumerate-the-ways" rel="prev" accesskey="p" title="Previous article: Enumerate the ways">Enumerate the ways</a></li> <li><a href="../../../../archives">All articles</a></li> <li class="icon next">Next: <a href="/2016/06/06/bbedit-package-for-middleman" rel="next" accesskey="n" title="Next article: BBEdit package for Middleman">BBEdit package for Middleman</a></li> </ol> </body> </html>